#!/bin/sh

. /etc/functions_base_fff+ && func_need vars_old

if [ "$REQUEST_METHOD" = "GET" ] && [ -n "$QUERY_STRING" ]; then

	func_need old tool http ipsystem

	eval $(_http query_string_sanitize)

	GUI=0
	fkt_print_html_header
	
	NODE="$( _ipsystem do $REMOTE_ADDR )"
	TIME="$( _system date unixtime                           )"
	DATE="$( date +%d%b%Y-%Huhr%M               )"

	cat >>/tmp/ARCHIV_TRAFFIC <<EOF
NODE=$NODE TIME=$TIME DATE=$DATE MAC=$MAC NAME=$NAME REG=$REG MEDIA=$MEDIA TRAFF_RECENT=$TRAFF_RECENT TRAFF_TODAY=$TRAFF_TODAY TRAFF_ALL=$TRAFF_ALL
EOF
	tail -n 250 "/tmp/ARCHIV_TRAFFIC"     >"/tmp/ARCHIV_TRAFFIC_temp"
	mv          "/tmp/ARCHIV_TRAFFIC_temp" "/tmp/ARCHIV_TRAFFIC"
	
	echo "OK"
	fkt_print_html_footer
else	
	GUI=1
	fkt_print_html_header
	echo "<pre>"
	cat /tmp/ARCHIV_TRAFFIC
	echo "</pre>"
	fkt_print_html_footer
fi
