#!/bin/sh

_cron_daemon_restart()
{
	local func="cron_daemon_restart"
	local reason="$1"

	_log do $func daemon info "[START] $reason"
	/etc/init.d/*crond* restart
	_log do $func daemon info "[READY]"
}

_cron_vpnserver()
{
	local funcname='cron_vpnserver'
	local ip="${1:-84.38.67.43}"
	local firstrun="/dev/shm/firstrun_$funcname"

	[ -e "$firstrun" ] || {
		touch "$firstrun"
		_log do $funcname daemon sms 'firstrun/bootup'

		# from default init-script with dummy-config
		killall vtund
	}

	ping -s 64 -c1 "$ip" >/dev/null || _log do $funcname daemon alert "ping to $ip failed"
	_olsr build_overview_static
	_vpn innercity_master_vtund check_on_server

	# uptime.sec->minutes divideable (without rest) by 360? -> each 360 mins
	read UP REST </proc/uptime
	[ $(( $(( ${UP%.*} / 60 )) % 360 )) -eq 0 ] && {
		_firmware update_pmu
		_watch archivsize '/www/everlasting_syslog.txt' 200 300
	}
}
