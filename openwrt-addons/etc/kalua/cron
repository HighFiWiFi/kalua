#!/bin/sh

_cron_daemon_restart()
{
	local func="cron_daemon_restart"
	local reason="$1"

	_log do $func daemon info "[START] $reason"
	/etc/init.d/*crond* restart
	_log do $func daemon info "[READY]"
}

_cron_vpnserver()
{
	local funcname='cron_vpnserver'
	local ip="${1:-84.38.67.43}"
	local firstrun="/dev/shm/firstrun_$funcname"

	# TODO: make sure, that vtund is not started via init

	[ -e "$firstrun" ] || {
		touch "$firstrun"
		_log do $funcname daemon sms 'firstrun/bootup'
	}

	ping -s 64 -c1 "$ip" >/dev/null || _log do $funcname daemon alert "ping to $ip failed"
	_olsr build_overview_static
	_vpn innercity_master_vtund check_on_server
}
